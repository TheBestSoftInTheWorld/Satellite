package com.example.technical.test;

import org.junit.jupiter.api.Test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.boot.test.web.client.TestRestTemplate;
import org.springframework.http.*;

import java.util.Arrays;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
public class FullListTest {
    final String API_PERSIST = "http://localhost:8080/api/fulllist";

    @Autowired
    private TestRestTemplate restTemplate;

    @Test
    public void getListFromCSV() throws Exception {
        HttpHeaders headers = new HttpHeaders();
        headers.setAccept(Arrays.asList(MediaType.APPLICATION_JSON));
        HttpEntity entity = new HttpEntity(headers);
        ResponseEntity<String> result = restTemplate.exchange(API_PERSIST, HttpMethod.GET, entity, String.class);
        String expected = "{\"id\":0,\"appointmentTime\":\"2022-06-18T11:00:56.000+00:00\",\"personId\":2,\"modified\":\"2022-06-18T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-19T11:00:56.000+00:00\",\"personId\":4,\"modified\":\"2022-06-19T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-20T11:00:56.000+00:00\",\"personId\":3,\"modified\":\"2022-06-20T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-21T11:00:56.000+00:00\",\"personId\":4,\"modified\":\"2022-06-21T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-22T06:00:56.000+00:00\",\"personId\":8,\"modified\":\"2022-06-22T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-23T06:00:56.000+00:00\",\"personId\":5,\"modified\":\"2022-06-23T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-24T06:00:56.000+00:00\",\"personId\":8,\"modified\":\"2022-06-24T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-25T06:00:56.000+00:00\",\"personId\":6,\"modified\":\"2022-06-25T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-26T06:00:56.000+00:00\",\"personId\":9,\"modified\":\"2022-06-26T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-27T06:00:56.000+00:00\",\"personId\":7,\"modified\":\"2022-06-27T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-28T06:00:56.000+00:00\",\"personId\":7,\"modified\":\"2022-06-28T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-29T06:00:56.000+00:00\",\"personId\":8,\"modified\":\"2022-06-29T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-06-30T06:00:56.000+00:00\",\"personId\":33,\"modified\":\"2022-06-30T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-01T06:00:56.000+00:00\",\"personId\":9,\"modified\":\"2022-07-01T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-02T06:00:56.000+00:00\",\"personId\":22,\"modified\":\"2022-07-02T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-03T06:00:56.000+00:00\",\"personId\":10,\"modified\":\"2022-07-03T06:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-04T11:00:56.000+00:00\",\"personId\":42,\"modified\":\"2022-07-04T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-05T11:00:56.000+00:00\",\"personId\":11,\"modified\":\"2022-07-05T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-06T11:00:56.000+00:00\",\"personId\":33,\"modified\":\"2022-07-06T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-07T11:00:56.000+00:00\",\"personId\":12,\"modified\":\"2022-07-07T11:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-08T13:00:56.000+00:00\",\"personId\":66,\"modified\":\"2022-07-08T13:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-09T13:00:56.000+00:00\",\"personId\":13,\"modified\":\"2022-07-09T13:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-10T13:00:56.000+00:00\",\"personId\":99,\"modified\":\"2022-07-10T13:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-11T13:00:56.000+00:00\",\"personId\":14,\"modified\":\"2022-07-11T13:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-12T14:00:56.000+00:00\",\"personId\":44,\"modified\":\"2022-07-12T14:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-13T14:00:56.000+00:00\",\"personId\":15,\"modified\":\"2022-07-13T14:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-14T14:00:56.000+00:00\",\"personId\":44,\"modified\":\"2022-07-14T14:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-15T14:00:56.000+00:00\",\"personId\":16,\"modified\":\"2022-07-15T14:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-16T14:00:56.000+00:00\",\"personId\":65,\"modified\":\"2022-07-16T14:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"APPROVED\"},{\"id\":0,\"appointmentTime\":\"2022-07-17T14:00:56.000+00:00\",\"personId\":17,\"modified\":\"2022-07-17T14:00:56.000+00:00\",\"reason\":\"consultation\",\"state\":\"NOT_APPROVED\"}";
        assertThat(result.getBody().equals(expected));
    }
}
